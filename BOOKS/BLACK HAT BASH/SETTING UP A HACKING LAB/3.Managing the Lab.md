# Managing your Kali + Docker Lab — shutdown, remove, rebuild (quick blog)

You’ve built a playground — now learn the safe, sensible ways to stop, wipe, and rebuild it. This short, practical guide shows the exact commands, explains what they do, and gives safety tips so you don’t lose work accidentally.

---

## Shutting down the lab (safe stop)

When you’re done for the day, stop everything cleanly:

```bash
cd ~/Black-Hat-Bash/lab
sudo make teardown

```

What it does: stops all lab containers and removes the ephemeral networks and volumes the Makefile created. You’ll see names like `Stopping p-web-02 ... done` and an “OK: lab has shut down.”

Why use it: clean shutdown avoids orphaned containers and leaves images available so you can bring the lab back up quickly.

---

## Completely removing the lab (destroy)

If you want to remove the whole lab — containers **and** images — use the cleanup command:

```bash
# repo uses cleanup as the Makefile target; some guides say "clean" — check `make help`
sudo make cleanup
# or (if your Makefile has it)
sudo make clean

```

What it does: stops containers, deletes volumes, and removes built images. This fully frees disk space but destroys any data in containers & persistent volumes.

---

## Rebuilding from scratch (wipe + redeploy)

If something broke during setup or you want a totally fresh environment, rebuild:

```bash
sudo make rebuild

```

What it does: teardown → remove images/volumes → deploy fresh. Useful after a failed install or if you’ve corrupted the lab by experiments.

Important: rebuilding **erases** container state. Treat it like formatting the environment.

---

## Preserve data before you wipe (backups & snapshots)

Before cleanup or rebuild, do one of these:

- **VM snapshot** (best): take a snapshot of the Kali VM in your hypervisor. Fast restore.
    
- **Export specific files:** copy files out of containers:
    
    ```bash
    docker cp p-web-01:/path/to/file /host/path/
    
    ```
    
- **Backup volumes:** use a temporary container to tar a named volume:
    
    ```bash
    docker run --rm -v lab_p_web_02_vol:/data -v $(pwd):/backup ubuntu \\
      bash -c "cd /data && tar czf /backup/p_web_02_vol.tgz ."
    
    ```
    
- **Dump databases** (MySQL/Postgres): use `mysqldump` or `pg_dump` into host-mounted folders.
    

Snapshots are easiest; volume/file backups are great if you want specific artifacts.

---

## Selective stop / manual control (when you don’t want full teardown)

Stop or restart single containers without bringing the whole lab down:

```bash
docker ps            # see running containers
docker stop p-web-01
docker start p-web-01
docker logs -f p-web-01
docker exec -it p-web-01 bash

```

Use these when you’re debugging a single service.

---

## Cleaning up Docker by hand (advanced)

If the Makefile leaves things behind, these are the low-level tools:

- Remove stopped containers:
    
    ```bash
    docker container prune
    
    ```
    
- Remove unused images:
    
    ```bash
    docker image prune -a
    
    ```
    
- Remove unused volumes (careful — this deletes data):
    
    ```bash
    docker volume prune
    
    ```
    
- Aggressive cleanup:
    
    ```bash
    docker system prune -a --volumes
    
    ```
    

**Warning:** `prune -a --volumes` frees a lot of space but destroys data. Only run when you’re sure.

---

## Troubleshooting common issues

- `make teardown` hangs: tail the installer/logs (`tail -f /var/log/lab-install.log`) or run `docker ps` to see which container is stuck.
- Permission errors after adding user to `docker` group: log out and back in, or run `newgrp docker`.
- Disk full during rebuild: check `docker images` and `docker system df`; remove old images or increase VM disk.
- Container fails to start on deploy: `docker logs <name>` for details; `docker inspect <name>` for network/config.

---

## Quick safety checklist (before teardown/cleanup/rebuild)

- Take a VM snapshot (recommended).
- Export any logs, flags, or files you want to keep.
- Stop active attacks / scripts.
- Run `sudo make teardown` if you only want to stop (not remove).
- Use `sudo make rebuild` only when you want a fresh, clean environment.

---

## Handy aliases you can add to `~/.bashrc`

```bash
alias labup='cd ~/Black-Hat-Bash/lab && sudo make deploy'
alias labdown='cd ~/Black-Hat-Bash/lab && sudo make teardown'
alias labclean='cd ~/Black-Hat-Bash/lab && sudo make cleanup'
alias labrebuild='cd ~/Black-Hat-Bash/lab && sudo make rebuild'

```

Reload with `source ~/.bashrc` and you’ll save typing.

---

## Final thought

Stopping, cleaning, and rebuilding are normal parts of lab life. Snapshots + selective backups are your best insurance against accidental data loss. When in doubt: snapshot first, then experiment — and use `make teardown` for routine shutdowns so you don’t lose your built images and avoid long rebuild times.